services:
  # 游깷 API Gateway (NGINX)
  api-gateway:
    build: ./gateway
    container_name: api-gateway
    ports:
      - "8080:80"
    depends_on:
      - auth-service
      - order-service
      - inventory-service
      - customer-service
      - payment-service
      - shipment-service
      - notification-service
    networks:
      - backend
    restart: unless-stopped

  # 游릭 Order Service
  order-service:
    build: ./services/order
    container_name: order-service
    ports:
      - "3001:3001"
    env_file:
      - ./services/order/.env
    depends_on:
      - order-mongo
      - rabbitmq
    networks:
      - backend

  order-mongo:
    image: mongo:6
    container_name: order-mongo
    ports:
      - "27017:27017"
    volumes:
      - order-data:/data/db
    networks:
      - backend

  # 游릭 Inventory Service
  inventory-service:
    build: ./services/inventory
    container_name: inventory-service
    ports:
      - "3002:3002"
    env_file:
      - ./services/inventory/.env
    depends_on:
      - inventory-mongo
      - rabbitmq
    networks:
      - backend

  inventory-mongo:
    image: mongo:6
    container_name: inventory-mongo
    ports:
      - "27018:27017"
    volumes:
      - inventory-data:/data/db
    networks:
      - backend

  # 游릭 Customer Service
  customer-service:
    build: ./services/customer
    container_name: customer-service
    ports:
      - "3003:3003"
    env_file:
      - ./services/customer/.env
    depends_on:
      - customer-mongo
    networks:
      - backend

  customer-mongo:
    image: mongo:6
    container_name: customer-mongo
    ports:
      - "27019:27017"
    volumes:
      - customer-data:/data/db
    networks:
      - backend

  # 游릭 Payment Service
  payment-service:
    build: ./services/payment
    container_name: payment-service
    ports:
      - "3004:3004"
    env_file:
      - ./services/payment/.env
    depends_on:
      - payment-mongo
      - rabbitmq
    networks:
      - backend

  payment-mongo:
    image: mongo:6
    container_name: payment-mongo
    ports:
      - "27020:27017"
    volumes:
      - payment-data:/data/db
    networks:
      - backend

  # 游릭 Shipment Service
  shipment-service:
    build: ./services/shipment
    container_name: shipment-service
    ports:
      - "3005:3005"
    env_file:
      - ./services/shipment/.env
    depends_on:
      - shipment-mongo
      - rabbitmq
    networks:
      - backend

  shipment-mongo:
    image: mongo:6
    container_name: shipment-mongo
    ports:
      - "27021:27017"
    volumes:
      - shipment-data:/data/db
    networks:
      - backend

  # 游릭 Notification Service
  notification-service:
    build: ./services/notification
    container_name: notification-service
    ports:
      - "3006:3006"
    env_file:
      - ./services/notification/.env
    depends_on:
      - notification-mongo
      - rabbitmq
    networks:
      - backend

  notification-mongo:
    image: mongo:6
    container_name: notification-mongo
    ports:
      - "27022:27017"
    volumes:
      - notification-data:/data/db
    networks:
      - backend

  # 游낺 RabbitMQ
  rabbitmq:
    image: rabbitmq:3-management
    container_name: rabbitmq
    ports:
      - "5672:5672"   # broker
      - "15672:15672" # management UI
    networks:
      - backend

  # 游댏 Auth service for JWT issuance and validation
  auth-service:
    build: ./gateway/auth-service
    container_name: auth-service
    ports:
      - "3000:3000"
    env_file:
      - ./gateway/auth-service/.env
    networks:
      - backend

volumes:
  order-data:
  inventory-data:
  customer-data:
  payment-data:
  shipment-data:
  notification-data:

networks:
  backend:
    driver: bridge
